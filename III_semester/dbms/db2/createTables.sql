CREATE TABLE tuba7791.Komanda (
  Nr          INTEGER NOT NULL PRIMARY KEY,
  Pavadinimas VARCHAR(25) NOT NULL
);

CREATE TABLE tuba7791.Zaidejas (
  AK      CHAR(11) NOT NULL PRIMARY KEY,
  Nr      SMALLINT NOT NULL CHECK (Nr BETWEEN 0 AND 99),
  Vardas  VARCHAR(50) NOT NULL,
  Pavarde VARCHAR(50) NOT NULL,
  Ugis    DECIMAL(3,2),
  Svoris  SMALLINT,
  Komanda INTEGER NOT NULL,
  CONSTRAINT SvRekomendacija CHECK (Svoris BETWEEN 40 AND 250),

  FOREIGN KEY Komandai(Komanda) REFERENCES tuba7791.Komanda
    ON DELETE RESTRICT ON UPDATE RESTRICT
);

CREATE TABLE tuba7791.Rungtynes (
  Nr        INTEGER NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  Komanda   INTEGER NOT NULL,
  Varzovas  INTEGER NOT NULL,
  Imesta    SMALLINT NOT NULL,
  Praleista SMALLINT NOT NULL,
  Data      DATE NOT NULL DEFAULT CURRENT DATE,
  CONSTRAINT TaskuKiekis CHECK (Imesta >= 0 AND Praleista >= 0 AND Imesta != Praleista),
  CONSTRAINT ZaidimasSuSavimi CHECK (Komanda != Varzovas),

  FOREIGN KEY Komandai(Komanda) REFERENCES tuba7791.Komanda
    ON DELETE RESTRICT ON UPDATE RESTRICT,
  FOREIGN KEY Priesininkam(Varzovas) REFERENCES tuba7791.Komanda
    ON DELETE RESTRICT ON UPDATE RESTRICT
);

CREATE TABLE tuba7791.Statistika (
  AK          CHAR(11) NOT NULL,
  Rungtynes   INTEGER NOT NULL,
  AKM         SMALLINT NOT NULL DEFAULT 0,
  RP          SMALLINT NOT NULL DEFAULT 0,
  Prazangos   SMALLINT NOT NULL DEFAULT 0,
  Klaidos     SMALLINT NOT NULL DEFAULT 0,
  Blokai      SMALLINT NOT NULL DEFAULT 0,
  PK          SMALLINT NOT NULL DEFAULT 0,
  Taskai      SMALLINT NOT NULL DEFAULT 0,
  CONSTRAINT PrazanguLimitas CHECK (Prazangos BETWEEN 0 AND 5),
  PRIMARY KEY (AK, Rungtynes),

  FOREIGN KEY Rungtynems(Rungtynes) REFERENCES tuba7791.Rungtynes
    ON DELETE RESTRICT ON UPDATE RESTRICT,
  FOREIGN KEY Zaidejui(AK) REFERENCES tuba7791.Zaidejas
    ON DELETE CASCADE ON UPDATE RESTRICT
);
